# before_compile:
#   - echo "Before compile"

# before_build:
#   - echo "Before build"

# before_deploy:
#   - echo "Before deploy"

after_deploy:
  - if [ $SEED_SERVICE_NAME = "sls-seed-react-infra-ui" ]; then npm run build --prefix user_interface; fi
  - if [ $SEED_SERVICE_NAME = "sls-seed-react-infra-ui" ]; then aws s3 sync user_interface/build/ s3://sls-seed-react-infra-hosting-$SEED_STAGE_NAME --delete; fi
  # - if [ $SEED_SERVICE_NAME = "sls-seed-react-infra-ui" ]; then apt-get install jq; fi
  # - if [ $SEED_SERVICE_NAME = "sls-seed-react-infra-ui" ]; then echo "export DIST_ID=$(aws secretsmanager get-secret-value --secret-id sls-seed-react-infra-cdn-$SEED_STAGE_NAME-cdn-id-secret-name | jq -r '.SecretString')" >> $BASH_ENV; fi  
  - if [ $SEED_SERVICE_NAME = "sls-seed-react-infra-ui" ]; then aws cloudfront create-invalidation --distribution-id $(aws secretsmanager get-secret-value --secret-id sls-seed-react-infra-cdn-dev-cdn-id-secret-name | jq -r '.SecretString') --paths "/*"; fi

# before_remove:
#   - echo "Before deploy"

# after_remove:
#   - echo "After deploy"


# sls-seed-react-infra-cdn-dev-cdn-id-secret-name
# sls-seed-react-infra-cdn-$SEED_STAGE_NAME-cdn-id-secret-name



# $SEED_SERVICE_NAME-$SEED_STAGE_NAME-cdn-id-secret-name
# ${self:service}-${self:provider.stage}-cdn-id-secret-name


# echo "export DIST_ID=$(aws secretsmanager get-secret-value --secret-id sample-secret | jq -r '.SecretString')" >> $BASH_ENV

# npm run build
# aws s3 sync build/ s3://YOUR_S3_DEPLOY_BUCKET_NAME
# aws s3 sync build/ s3://YOUR_S3_DEPLOY_BUCKET_NAME --delete
# aws cloudfront create-invalidation --distribution-id YOUR_CF_DISTRIBUTION_ID --paths "/*"
# aws cloudfront create-invalidation --distribution-id YOUR_WWW_CF_DISTRIBUTION_ID --paths "/*"


# apt-get install jq
# aws secretsmanager get-secret-value --secret-id sample-secret | jq -r ".SecretString"